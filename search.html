<!DOCTYPE html>
<html lang="en">
<head>
  <title>Free Speech Movement Archive</title>
  <link rel="stylesheet" href="static/css/bootstrap.css">
  <link rel="stylesheet" href="static/css/custom.css">
  <link rel="stylesheet" href="static/css/search.css">
  <link href ='http://fonts.googleapis.com/css?family=Oswald|BenchNine' rel='stylesheet' type='text/css'>
</head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js" type="text/javascript">
</script>

<body>
  {% include "header.html" %}
  <h2>Search Results for: {{query}}</h2>
  
    {% if typeOfResource == "image" %}
      <div id="img-result">
        {% for doc in response %}
          <a href={{"/article?id=" + doc["id"].replace(' ', '%20')}}>
          <img src={{doc["fsmImageUrl"][0]}} style="max-height:100%"/></a>
        {% endfor %}
      </div>

    {% else %}
      <div id="text-result">
        {% for doc in response %}
            {% for t in doc["fsmTypeOfResource"] %}
              <span class='type {{t}}'> {{t}} </span>
            {% endfor %}
            
            <div class="result">
                <a class="link" href={{"/article?id=" + doc["id"].replace(' ', '%20')}}>{{doc["fsmTitle"][0]}}</a>
                {% if doc["fsmRelatedTitle"] %}
                  ({{"; ".join(doc["fsmRelatedTitle"])}})
                {% endif %}
                &mdash; <i>{{"; ".join(doc["fsmCreator"])}}</i>
                <p class='snippet' id={{doc["fsmTeiUrl"][0]}}></p>
                <span id={{'snippet' + doc["fsmTeiUrl"][0].replace(':', '').replace('.', '').replace('/', '')}}>#matches: 0</span>
            </div>
        {% endfor %}
      </div>
    {% endif %}

  <h3>
    {% for elem in range(numPages) %}
      <a href={{"/search?%s&start=%s" % (queryParameters, elem + 1)}}>{{elem + 1}}</a>
    {% endfor %}
  </h3>
</body>
<script>
  $(document).ready(function(){
    $('.snippet').each(function(i, obj) {
      $.ajax({
        url: '/find_snippets',
        type: 'GET',
        data: {'fsmTeiUrl': obj.id, 'query': '{{query}}'},
        dataType: 'json',
        success: function(data, status){
          obj.innerHTML = data.snippet;
          $('#snippet' + data.fsmTeiUrl.replace(/[.:\/]/g, ''))[0].innerHTML = "#matches: " + data.matches;
        }
      });
    });

    if ($("#img-result").length == 0) {
      $("#filter").show();
      $("h2").css({"margin-right": "15%"});
      $("h3").css({"margin-right": "15%"});
    }
    else if ($("#img-result").length == 0) {
      
    }
  });
</script>
</html>
